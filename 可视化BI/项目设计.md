# 项目设计

## 1. 系统架构

### 1.1 整体架构

```ascii
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   前端层    │     │   后端层    │     │   数据层    │
│  Frontend   │────>│  Backend    │────>│  Database   │
└─────────────┘     └─────────────┘     └─────────────┘
     React           Node.js/Express        MySQL 8.0
```

### 1.2 技术架构

1. **前端架构**

   ```ascii
   React Application
   ├── 组件层 (Components)
   │   ├── 页面组件 (Pages)
   │   ├── 业务组件 (Business)
   │   └── 通用组件 (Common)
   ├── 状态管理 (State Management)
   ├── 路由管理 (Router)
   └── 工具库 (Utils)
   ```

2. **后端架构**
   ```ascii
   Node.js Application
   ├── API 层 (Controllers)
   ├── 服务层 (Services)
   ├── 数据访问层 (Models)
   └── 中间件层 (Middlewares)
   ```

### 1.3 部署架构

```ascii
                    负载均衡器
                        │
        ┌──────────────┴──────────────┐
        │                             │
    前端服务器                    后端服务器
  (Static Files)               (Node.js App)
        │                             │
        └──────────────┬──────────────┘
                       │
                   数据库服务器
                  (MySQL 8.0)
```

## 2. 数据库设计

### 2.1 表结构设计

**power_forecast 表**

| 字段名                                   | 类型          | 是否为空 | 默认值 | 说明                         |
| ---------------------------------------- | ------------- | -------- | ------ | ---------------------------- |
| id                                       | INT           | NO       | AUTO   | 主键，自增                   |
| 日期                                     | DATE          | NO       | -      | 数据日期                     |
| 时间                                     | TIME          | NO       | -      | 数据时间点                   |
| 日前水电含抽蓄发电出力预测\_MW           | DECIMAL(10,2) | YES      | NULL   | 水电出力预测（兆瓦）         |
| 日前各交易时段负荷预测\_MW               | DECIMAL(10,2) | YES      | NULL   | 负荷预测（兆瓦）             |
| 日前发电总出力预测\_MW                   | DECIMAL(10,2) | YES      | NULL   | 发电总出力预测（兆瓦）       |
| 日前各交易时段外来\_外送\_电交易计划\_MW | DECIMAL(10,2) | YES      | NULL   | 外来/外送电交易计划（兆瓦）  |
| 日前非市场化机组出力\_MW                 | DECIMAL(10,2) | YES      | NULL   | 非市场化机组出力（兆瓦）     |
| 新能源总出力预测数值                     | DECIMAL(10,2) | YES      | NULL   | 新能源总出力预测（兆瓦）     |
| 光电总出力预测数值                       | DECIMAL(10,2) | YES      | NULL   | 光伏出力预测（兆瓦）         |
| 风电总出力预测数值                       | DECIMAL(10,2) | YES      | NULL   | 风电出力预测（兆瓦）         |
| 日前电力供需平衡预测                     | DECIMAL(10,2) | YES      | NULL   | 电力供需平衡预测（兆瓦）     |
| 次周新能源出力预测                       | DECIMAL(10,2) | YES      | NULL   | 次周新能源出力预测（兆瓦）   |
| 日前\_实时各交易时段出清总电量及均价     | VARCHAR(255)  | YES      | NULL   | 出清电量及均价               |
| 电网实际负荷实时系统备用信息\_负荷       | DECIMAL(10,2) | YES      | NULL   | 实际负荷（兆瓦）             |
| 电网实际负荷实时系统备用信息\_正备用     | DECIMAL(10,2) | YES      | NULL   | 正备用容量（兆瓦）           |
| 电网实际负荷实时系统备用信息\_负备用     | DECIMAL(10,2) | YES      | NULL   | 负备用容量（兆瓦）           |
| 非市场化机组实际出力曲线                 | DECIMAL(10,2) | YES      | NULL   | 非市场化机组实际出力（兆瓦） |

### 2.2 索引设计

```sql
-- 主键索引
PRIMARY KEY (`id`),
-- 复合索引（用于时间范围查询）
INDEX `idx_date_time` (`日期`, `时间`),
-- 单列索引（用于负荷预测查询）
INDEX `idx_load_forecast` (`日前各交易时段负荷预测_MW`),
-- 单列索引（用于实际负荷查询）
INDEX `idx_actual_load` (`电网实际负荷实时系统备用信息_负荷`),
-- 单列索引（用于新能源预测查询）
INDEX `idx_renewable_forecast` (`新能源总出力预测数值`)
```

### 2.3 数据查询优化

1. **常用查询场景**

   - 时间范围内的负荷预测和实际负荷对比
   - 新能源出力预测趋势分析
   - 系统备用容量监控

2. **查询优化策略**
   - 使用覆盖索引减少回表
   - 针对时间范围查询优化
   - 大数据量分页查询优化

## 3. 接口设计

### 3.1 RESTful API 规范

基础 URL: `https://cidjdkmkznoh.sealoshzh.site:3000/api`

#### 响应格式

```json
{
  "status": "success|error",
  "data": Object|Array,
  "message": "错误信息（可选）"
}
```

### 3.2 接口列表

1. **获取电力数据**

   ```
   GET /power-forecast
   ```

   - 响应示例：
     ```json
     {
       "status": "success",
       "data": [
         {
           "日期": "2025-02-01",
           "时间": "00:15",
           "日前水电含抽蓄发电出力预测_MW": 56.0,
           "日前各交易时段负荷预测_MW": 25529.0,
           "日前发电总出力预测_MW": 28767.38,
           "新能源总出力预测数值": 3182.38,
           "电网实际负荷实时系统备用信息_负荷": 25234.8,
           "电网实际负荷实时系统备用信息_正备用": 8033.36,
           "电网实际负荷实时系统备用信息_负备用": 6052.3
         }
       ]
     }
     ```

2. **获取数据统计**
   ```
   GET /power-forecast/stats
   ```
   - 参数：
     - date: string (格式: YYYY-MM-DD)
   - 响应示例：
     ```json
     {
       "status": "success",
       "data": {
         "maxLoad": 25529.0,
         "minLoad": 24639.0,
         "avgRenewable": 3179.85
       }
     }
     ```

### 3.3 错误处理

**错误响应格式**：

```json
{
  "status": "error",
  "message": "错误描述",
  "code": "错误代码"
}
```

**常见错误代码**：

- 400: 请求参数错误
- 404: 资源不存在
- 500: 服务器内部错误

## 5. 性能优化

### 5.1 性能指标

1. **响应时间要求**

   - 页面首次加载时间 < 2 秒
   - API 响应时间 < 500ms
   - 图表渲染时间 < 1 秒

2. **并发处理**

   - 支持 50+ 用户同时在线
   - 数据库连接池：20-50

3. **数据限制**
   - 单次查询记录数 ≤ 1000
   - 图表数据点 ≤ 500

### 5.2 优化策略

1. **数据库优化**

   - 合理使用索引
   - 查询语句优化
   - 连接池配置

2. **前端优化**

   - 路由懒加载
   - 组件按需加载
   - 数据缓存策略

3. **API 优化**
   - 数据压缩
   - 请求合并
   - 响应缓存
